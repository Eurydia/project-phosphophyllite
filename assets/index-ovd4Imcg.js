import{j as t,r as c,a as gt}from"./react-Fj6bOIfE.js";import{b as jt}from"./react-dom-xQmlCP6c.js";import{L as O,u as T,c as xt,R as wt}from"./react-router-dom-PhFDRiZb.js";import{g as kt,h as I}from"./react-router-BpImC_eU.js";import{S as vt,P as bt,G as d,I as M,T as h,a as L,C as W,B as F,b as k,c as yt,M as Tt,d as It,L as H,e as G,f as $,A as _,g as C,h as X,i as Y,j as J,O as Q,k as A,F as V,E as tt,l as U,m as Z,u as N,n as et,o as rt,p as Ct,q as St,r as Et}from"./@mui-DdYmStMr.js";import{o as Pt}from"./idb-Dob3nYDb.js";import{L as b}from"./lz-string-nJpI0Gkk.js";import{l as Rt,d as Lt}from"./@monaco-editor-C6nOapT0.js";import{u as Mt}from"./unified-CuGp7EWb.js";import{r as Ft}from"./remark-parse-EFvJtpNF.js";import{r as Ot}from"./remark-gfm-D1kqK4Sh.js";import{r as Nt}from"./remark-math-DcEIj4mF.js";import{r as Dt}from"./remark-rehype-ciVG95nT.js";import{r as zt}from"./rehype-sanitize-Ctd_RbWx.js";import{r as Bt}from"./rehype-katex-Dz5iAQV3.js";import{r as Wt}from"./rehype-document-Bflo6tOM.js";import{r as Ht}from"./rehype-stringify-lhHBmWf5.js";import{e as w}from"./@remix-run-BWstt0hZ.js";import{u as ot}from"./react-hotkeys-hook-dnq5CXFg.js";/* empty css                    */import"./@babel-BmrWWf-u.js";import"./scheduler-CKyTKYc2.js";import"./prop-types-DYSGp4Uy.js";import"./@emotion-mbt7MCjG.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-NkKAe6Bn.js";import"./react-is-CX4zgkE_.js";import"./clsx-B-dksMZM.js";import"./@popperjs-DXqTHVUr.js";import"./react-transition-group-BReq8V5i.js";import"./state-local-BBNhjlcY.js";import"./bail-FqpXQuLt.js";import"./extend-LZ2YLlyH.js";import"./is-plain-obj-C1gvLhAf.js";import"./trough-B_b8ryxu.js";import"./vfile-D1_tGWGU.js";import"./vfile-message-Bq256rVA.js";import"./unist-util-stringify-position-Ch_qCilz.js";import"./mdast-util-from-markdown-2tgvbwPK.js";import"./micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./micromark-util-decode-string-strjl-tx.js";import"./decode-named-character-reference-C3-224fz.js";import"./micromark-util-normalize-identifier-C9ANKk3v.js";import"./micromark-DwZcK08u.js";import"./micromark-util-combine-extensions-Bka6Sc1c.js";import"./micromark-util-chunked-DrRIdSP-.js";import"./micromark-factory-space-6dA1Il-k.js";import"./micromark-util-character-DjYUzTuj.js";import"./micromark-core-commonmark-Dhiatyfo.js";import"./micromark-util-classify-character-o5XIcufE.js";import"./micromark-util-resolve-all-PQCKh0dx.js";import"./micromark-util-subtokenize-QwsxNXk2.js";import"./micromark-factory-destination-BG3Y82VO.js";import"./micromark-factory-label-DJOX7mP1.js";import"./micromark-factory-title-vnv7pB58.js";import"./micromark-factory-whitespace-02qDvY4j.js";import"./micromark-util-html-tag-name-DbKNfynz.js";import"./mdast-util-to-string-DzL_e8Nz.js";import"./micromark-extension-gfm-C0wcyJXf.js";import"./micromark-extension-gfm-autolink-literal-C1bqX4YS.js";import"./micromark-extension-gfm-footnote-DW4b5mJ1.js";import"./micromark-extension-gfm-strikethrough-DLG0h2kg.js";import"./micromark-extension-gfm-table-bNMuBszt.js";import"./micromark-extension-gfm-task-list-item-9nPgC00f.js";import"./mdast-util-gfm-CwHVOxL1.js";import"./mdast-util-gfm-autolink-literal-D8s825iC.js";import"./ccount-c2V3InAJ.js";import"./devlop-0Dp3JUBc.js";import"./mdast-util-find-and-replace-ClOhUni4.js";import"./unist-util-is-D9KQvrmg.js";import"./unist-util-visit-parents-CUezI4aM.js";import"./mdast-util-gfm-footnote-B3y08S0o.js";import"./mdast-util-gfm-strikethrough-Cj9qKt6Q.js";import"./mdast-util-gfm-table-DXHwCURR.js";import"./markdown-table-De3aUdCo.js";import"./mdast-util-to-markdown-B2xn9m8u.js";import"./longest-streak-CtXnX3Xp.js";import"./unist-util-visit-Dza3JKCM.js";import"./mdast-util-phrasing-C4Vf_nAi.js";import"./mdast-util-gfm-task-list-item-BF8d1Wp-.js";import"./micromark-extension-math-CUC_GoCG.js";import"./katex-RUdq65sM.js";import"./mdast-util-math-Dj7v4WU-.js";import"./mdast-util-to-hast-B1X7BmrI.js";import"./@ungap-DDJC10qW.js";import"./micromark-util-sanitize-uri-CajitOl6.js";import"./unist-util-position-Dg4u7XPN.js";import"./trim-lines-D8znQY54.js";import"./hast-util-sanitize-CJiiCdfB.js";import"./hast-util-from-html-isomorphic-DWKUa-bN.js";import"./hast-util-from-dom-CFM1EDMd.js";import"./web-namespaces-bsVAaBS1.js";import"./hastscript-C3d41mAm.js";import"./property-information-BosuZr9r.js";import"./comma-separated-tokens-CRUGqg4f.js";import"./space-separated-tokens-D7QSIrTI.js";import"./hast-util-parse-selector-TXfch5wI.js";import"./hast-util-to-text-CQFnfAl4.js";import"./hast-util-is-element-DyH4pHXM.js";import"./unist-util-find-after-DoQrf0b7.js";import"./hast-util-to-html-B01rvPa2.js";import"./html-void-elements-CkdplsNl.js";import"./zwitch-C2o2j-tx.js";import"./stringify-entities-DX2AxK7f.js";import"./character-entities-legacy-BpoLgcEt.js";import"./character-entities-html4-D7taRCQ7.js";import"./hast-util-whitespace-D4Wp6AEg.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();const $t=e=>t.jsx(vt,{...e,children:t.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",height:"1em",width:"1em",children:t.jsx("path",{d:"M10.25 2c.19 0 .36.11.44.26l2.22 3.96.09.28-.09.28-2.22 3.96c-.08.15-.25.26-.44.26h-4.5c-.19 0-.36-.11-.44-.26L3.09 6.78 3 6.5l.09-.28 2.22-3.96c.08-.15.25-.26.44-.26h4.5m0 11c.19 0 .36.11.44.26l2.22 3.96.09.28-.09.28-2.22 3.96c-.08.15-.25.26-.44.26h-4.5c-.19 0-.36-.11-.44-.26l-2.22-3.96L3 17.5l.09-.28 2.22-3.96c.08-.15.25-.26.44-.26h4.5m9.25-5.5c.19 0 .36.11.44.26l2.22 3.96.09.28-.09.28-2.22 3.96c-.08.15-.25.26-.44.26H15c-.19 0-.36-.11-.44-.26l-2.22-3.96-.09-.28.09-.28 2.22-3.96c.08-.15.25-.26.44-.26h4.5z"})})}),y=e=>{const{location:r,children:i,seconadaryNav:n}=e;return t.jsxs(c.Fragment,{children:[t.jsx(bt,{square:!0,variant:"outlined",sx:{width:"100%",paddingY:1,paddingX:2},children:t.jsxs(d,{container:!0,spacing:1,alignItems:"center",children:[t.jsx(d,{item:!0,xs:1,display:"flex",justifyContent:"center",children:t.jsx(M,{disableRipple:!0,title:"Home",component:O,to:"/",children:t.jsx($t,{})})}),t.jsx(d,{item:!0,xs:5,children:t.jsx(h,{variant:"body1",width:"100%",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",fontWeight:"500",children:r})}),t.jsx(d,{item:!0,xs:6,children:t.jsx(L,{spacing:2,justifyContent:"end",direction:"row",children:n})})]})}),i]})},K=()=>{const e=kt();return c.useEffect(()=>{document.title=`${e.status} ${e.statusText}`},[]),t.jsx(y,{location:e.statusText,children:t.jsx(W,{maxWidth:"md",children:t.jsxs(F,{padding:4,children:[t.jsx(h,{component:"h1",variant:"h1",children:e.status}),t.jsx(h,{paragraph:!0,component:"p",variant:"body1",children:e.statusText})]})})})},nt=(e,r,i)=>{if(r.length<=0)return;let n=r[0].compareFn;if(!e){for(const o of r)if(o.value===e){n=o.compareFn;break}}i.sort(n)},it=e=>{let r=[];return e&&(r=e.normalize().split(",")),r},v=Pt("primary",2,{upgrade(e){e.version>=2&&e.createObjectStore("tickets",{keyPath:"ticketId",autoIncrement:!0}).createIndex("by-project-id","projectId"),e.version>=1&&e.createObjectStore("projects",{keyPath:"projectId",autoIncrement:!0})}}),At=async(e,r,i)=>await(await v).add("projects",{name:e.normalize(),tags:i.map(o=>o.normalize()),lastModified:new Date(Date.now()),dateCreated:new Date(Date.now()),description:b.compressToUTF16(r.normalize())}),st=async(e,r,i,n)=>{const o=await(await v).get("projects",e);return(await v).put("projects",{projectId:e,name:r.normalize().trim(),tags:n.map(s=>s.normalize()),dateCreated:o?o.dateCreated:new Date(Date.now()),lastModified:new Date(Date.now()),description:b.compressToUTF16(i.normalize().trim())})},D=async e=>{const r=await(await v).get("projects",e);if(r)return r.description=b.decompressFromUTF16(r.description),r},q=async()=>{const e=await(await v).getAll("projects");for(let r=0;r<e.length;r++)e[r].description=b.decompressFromUTF16(e[r].description);return e},Ut=async(e,r,i,n)=>await(await v).add("tickets",{projectId:e,title:r.normalize(),tags:n.map(o=>o.normalize()),lastModified:new Date(Date.now()),dateCreated:new Date(Date.now()),content:b.compressToUTF16(i.normalize())}),at=async e=>{const r=await(await v).get("tickets",e);if(r)return r.content=b.decompressFromUTF16(r.content),r},ct=async()=>{const e=await(await v).getAll("tickets");for(let r=0;r<e.length;r++)e[r].content=b.decompressFromUTF16(e[r].content);return e},S=async()=>{const e=await q(),r=await ct(),i=new Set(["open","close"]);for(const o of e)for(const s of o.tags)i.add(s);for(const o of r)for(const s of o.tags)i.add(s);const n=[...i];return n.sort(),n},dt=[{value:"lastModified",label:"Last modified (0-9)",compareFn:(e,r)=>r.lastModified.getTime()-e.lastModified.getTime()},{value:"name",label:"Name (A-Z)",compareFn:(e,r)=>e.name.localeCompare(r.name)}],qt=async({request:e})=>{document.title="Projects";const r=new URL(e.url),i=await q(),n=await S(),o=r.searchParams.get("tags"),s=r.searchParams.get("sortRule"),a=it(o);return nt(s,dt,i),{sortRule:s,projects:i,filterTags:a,tagOptions:n}},lt=e=>{const{buttonProps:r,...i}=e,n=c.useRef(null),[o,s]=c.useState(null);return t.jsxs(c.Fragment,{children:[t.jsx(k,{...r,ref:n,onClick:()=>s(n.current),children:"Sort"}),t.jsx(yt,{...i,anchorEl:o,open:o!==null,onClose:()=>s(null)})]})},ut=e=>{const{sortRules:r,rule:i,onChange:n}=e;return t.jsx(Tt,{children:r.map(({label:o,value:s},a)=>t.jsxs(It,{value:s,onClick:()=>n(s),children:[t.jsxs(H,{children:[s===i&&t.jsx(G,{}),(i===null||i==="")&&a===0&&t.jsx(G,{})]}),t.jsx($,{children:o})]},s))})},E=e=>{const{width:r,fullWidth:i,options:n,value:o,onChange:s}=e;return t.jsx(_,{freeSolo:!0,fullWidth:i,multiple:!0,limitTags:3,size:"small",options:n,value:o,onChange:(a,l)=>s(l),renderInput:a=>t.jsx(C,{...a,label:"Tags",size:"small"}),sx:{width:r}})},Gt=e=>{const{projects:r}=e;return r.length===0?t.jsx(h,{variant:"body1",fontStyle:"italic",children:"No project to display."}):t.jsx(X,{children:r.map(({name:i,tags:n,projectId:o},s)=>t.jsxs(Y,{children:[t.jsx(H,{children:t.jsx(h,{width:"100%",display:"flex",alignItems:"center",justifyContent:"cetner",fontWeight:"bolder",color:"secondary",fontSize:"large",children:o})}),t.jsx($,{title:i,primaryTypographyProps:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"50%"},secondary:n.join(", "),children:i}),t.jsx(J,{children:t.jsx(M,{title:"Open",component:O,to:`/project/${o}`,color:"primary",children:t.jsx(Q,{})})})]},`project-${s}`))})},Zt=()=>{const{projects:e,sortRule:r,filterTags:i,tagOptions:n}=I(),o=T(),[s,a]=c.useState(i),l=g=>{o({sortRule:g,tags:s},{action:"/",method:"get"})},p=()=>{o({sortRule:r||"",tags:s},{action:"/",method:"get"})};return t.jsx(y,{location:"Projects",seconadaryNav:t.jsx(k,{disableElevation:!0,variant:"contained",component:O,startIcon:t.jsx(A,{}),to:"/project/create",children:"new project"}),children:t.jsxs(L,{spacing:2,padding:2,children:[t.jsxs(L,{spacing:1,direction:"row",width:"50%",children:[t.jsx(E,{options:n,value:s,onChange:a,width:"70%"}),t.jsx(k,{disableElevation:!0,variant:"outlined",onClick:p,startIcon:t.jsx(V,{}),children:"filter"}),t.jsx(lt,{buttonProps:{disableElevation:!0,variant:"outlined",startIcon:t.jsx(tt,{})},children:t.jsx(ut,{sortRules:dt,rule:r,onChange:l})})]}),t.jsx(Gt,{projects:e})]})})},mt=U({palette:{mode:"dark",primary:{main:"#00D3D0"},secondary:{main:"#D68F3E"},background:{default:"#1B1D2D",paper:"#1B1D2D"},text:{primary:Z("#fff",.78),secondary:Z("#fff",.57)}}}),Kt=U({components:{MuiCssBaseline:{styleOverrides:{html:{backgroundColor:mt.palette.background},pre:{width:"100%",overflow:"auto",scrollbarWidth:"thin"}}}}}),pt=U({palette:mt.palette,components:Kt.components}),ht=await Rt.init();ht.editor.defineTheme("markdown-dark",{base:"vs-dark",inherit:!0,rules:[{background:"2E3440",token:""},{foreground:"616e88",token:"comment"},{foreground:"a3be8c",token:"string"},{foreground:"b48ead",token:"constant.numeric"},{foreground:"81a1c1",token:"constant.language"},{foreground:"81a1c1",token:"keyword"},{foreground:"81a1c1",token:"storage"},{foreground:"81a1c1",token:"storage.type"},{foreground:"8fbcbb",token:"entity.name.class"},{foreground:"8fbcbb",fontStyle:"  bold",token:"entity.other.inherited-class"},{foreground:"88c0d0",token:"entity.name.function"},{foreground:"81a1c1",token:"entity.name.tag"},{foreground:"8fbcbb",token:"entity.other.attribute-name"},{foreground:"88c0d0",token:"support.function"},{foreground:"f8f8f0",background:"f92672",token:"invalid"},{foreground:"f8f8f0",background:"ae81ff",token:"invalid.deprecated"},{foreground:"b48ead",token:"constant.color.other.rgb-value"},{foreground:"ebcb8b",token:"constant.character.escape"},{foreground:"8fbcbb",token:"variable.other.constant"}],colors:{"editor.foreground":"#D8DEE9","editor.background":pt.palette.background.default,"editor.selectionBackground":"#434C5ECC","editor.lineHighlightBackground":"#3B4252","editorCursor.foreground":"#D8DEE9","editorWhitespace.foreground":"#434C5ECC"}});ht.editor.setTheme("markdown-dark");const z=e=>t.jsx(Lt,{...e,language:"markdown",defaultLanguage:"markdown",theme:"markdown-dark",options:{minimap:{enabled:!1},wordWrap:"on",wordBreak:"normal",folding:!1,fontSize:18,fontFamily:"Fira Code",fontLigatures:!0}}),B=e=>Mt().use(Ft,{fragment:!0}).use(Ot).use(Nt).use(Dt).use(zt).use(Bt).use(Wt,{css:"https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"}).use(Ht).processSync(e.normalize()).toString(),_t=e=>{const{childLeft:r,childRight:i}=e,n=c.useRef(null),[o,s]=c.useState("");return c.useEffect(()=>{if(!n||!n.current)return;const a=n.current.offsetTop;s(`calc(99vh - ${a}px)`)},[n]),t.jsx(F,{ref:n,paddingTop:2,paddingLeft:2,children:t.jsxs(d,{container:!0,spacing:2,children:[t.jsx(d,{item:!0,md:6,height:o,children:r}),t.jsx(d,{item:!0,md:6,height:o,children:i})]})})},Xt=()=>{const e=I(),r=N(),i=T(),[n,o]=c.useState(""),[s,a]=c.useState(""),[l,p]=c.useState([]),g=async()=>{if(n.trim().length===0)return;const u=await At(n,s,l);i({},{action:`/project/${u}`,method:"get"})};return c.useEffect(()=>{const u=document.getElementById("preview");u&&(u.innerHTML=B(s))},[s]),t.jsx(y,{location:"New project",seconadaryNav:t.jsx(k,{disableElevation:!0,disabled:n.trim().length===0,variant:"contained",onClick:g,startIcon:t.jsx(A,{}),children:"Create project"}),children:t.jsx(_t,{childLeft:t.jsxs(d,{container:!0,spacing:1,height:"100%",children:[t.jsx(d,{item:!0,md:12,children:t.jsx(C,{fullWidth:!0,required:!0,size:"small",label:"Project name",color:n.trim().length===0?"error":"primary",value:n,onChange:u=>o(u.target.value.normalize())})}),t.jsx(d,{item:!0,md:12,children:t.jsx(E,{fullWidth:!0,options:e,value:l,onChange:p})}),t.jsx(d,{item:!0,md:12,children:t.jsx(h,{color:r.palette.text.secondary,children:"Description"})}),t.jsx(d,{item:!0,md:12,children:t.jsx(z,{value:s,onChange:u=>a(u||"")})})]}),childRight:t.jsx(h,{id:"preview",maxWidth:"100%",height:"100%",overflow:"auto",variant:"body1",component:"main",display:"block"})})})},Yt=async()=>(document.title="New project",await S()),Jt=async({params:e})=>{if(!e.projectId)throw w({},{status:400,statusText:"Bad request."});const r=Number.parseInt(e.projectId);if(!Number.isFinite(r))throw w({},{status:404,statusText:"Invalid project ID."});const i=await D(r);if(!i)throw w({},{status:404,statusText:"Project not found."});document.title=i.name;const n=await S();return{project:i,tagOptions:n}},Qt=e=>{const{isEditMode:r,slotEditor:i,slotPreview:n}=e,o=c.useRef(null),[s,a]=c.useState("");return c.useEffect(()=>{if(!o||!o.current)return;const l=o.current.offsetTop;a(`calc(98vh - ${Math.floor(l)}px)`)},[o]),t.jsx(F,{ref:o,paddingTop:2,marginLeft:2,children:t.jsxs(d,{container:!0,spacing:2,children:[r&&t.jsx(d,{item:!0,md:6,height:s,children:i}),t.jsx(d,{item:!0,md:!0,height:s,overflow:"auto",children:n})]})})},Vt=()=>{const{project:e,tagOptions:r}=I(),i=N(),n=T(),[o,s]=c.useState(!1),[a,l]=c.useState(e),[p,g]=c.useState(a.name),[u,f]=c.useState(a.description),[x,P]=c.useState(a.tags);ot("ctrl+alt+e",()=>s(!o)),c.useEffect(()=>{(async()=>{if(!a||!o)return;const m=await st(a.projectId,p,u,x),j=await D(m);j&&l(j)})()},[u,x,p,o]),c.useEffect(()=>{const m=document.getElementById("preview");m&&(m.innerHTML=B(u))},[u]);const R=()=>{!a||!a.projectId||n({projectId:a.projectId},{action:"/ticket",method:"get"})};if(a)return t.jsxs(y,{location:a.name,seconadaryNav:t.jsx(k,{disableElevation:!0,variant:"contained",onClick:R,children:"tickets view"}),children:[t.jsx(M,{color:"primary",title:o?"Read":"Edit",sx:{position:"fixed",right:i.spacing(2),bottom:i.spacing(2)},onClick:()=>s(!o),children:o?t.jsx(et,{}):t.jsx(rt,{})}),t.jsx(Qt,{isEditMode:o,slotEditor:t.jsxs(d,{container:!0,spacing:1,height:"100%",children:[t.jsx(d,{item:!0,md:12,children:t.jsx(C,{fullWidth:!0,required:!0,size:"small",label:"Project name",color:p.trim().length===0?"error":"primary",value:p,onChange:m=>g(m.target.value.normalize())})}),t.jsx(d,{item:!0,md:12,children:t.jsx(E,{fullWidth:!0,options:r,value:x,onChange:P})}),t.jsx(d,{item:!0,md:12,children:t.jsx(z,{value:u,onChange:m=>f(m||"")})})]}),slotPreview:t.jsxs(W,{maxWidth:"sm",children:[!o&&t.jsxs(c.Fragment,{children:[t.jsxs(h,{variant:"subtitle2",children:["Created:"," ",a.dateCreated.toUTCString()]}),t.jsxs(h,{variant:"subtitle2",children:["Last modified:"," ",a.lastModified.toUTCString()]}),t.jsxs(h,{variant:"subtitle2",children:["Tags:"," ",a.tags.length>0?a.tags.join(", "):"-"]})]}),t.jsx(h,{id:"preview",maxWidth:"100%",height:"100%",overflow:"auto",component:"main",display:"block",sx:{wordBreak:"break-word",wordWrap:"break-word",scrollbarWidth:"thin"}})]})})]})},te=e=>{const{childLeft:r,childRight:i}=e,n=c.useRef(null),[o,s]=c.useState("");return c.useEffect(()=>{if(!n||!n.current)return;const a=n.current.offsetTop;s(`calc(100vh - ${Math.ceil(a)}px)`)},[n]),t.jsx(F,{ref:n,overflow:"hidden",children:t.jsxs(d,{container:!0,spacing:2,paddingTop:2,paddingLeft:2,children:[t.jsx(d,{item:!0,md:6,height:o,children:r}),t.jsx(d,{item:!0,md:6,height:o,overflow:"auto",children:i})]})})},ee=()=>{const{tagOptions:e,projectId:r}=I(),i=N(),n=T(),[o,s]=c.useState(""),[a,l]=c.useState(""),[p,g]=c.useState([]),u=async()=>{if(o.trim().length===0)return;const f=await Ut(r,o,a,p);n({},{action:`/ticket/${f}`,method:"get"})};return c.useEffect(()=>{const f=document.getElementById("preview");f&&(f.innerHTML=B(a))},[a]),t.jsx(y,{location:"New ticket",seconadaryNav:t.jsx(k,{disabled:o.trim().length===0,variant:"contained",onClick:u,children:"Open ticket"}),children:t.jsx(te,{childLeft:t.jsxs(d,{container:!0,spacing:1,height:"100%",children:[t.jsx(d,{item:!0,md:12,children:t.jsx(C,{fullWidth:!0,required:!0,size:"small",label:"Ticket title",color:o.trim().length===0?"error":"primary",value:o,onChange:f=>s(f.target.value.normalize())})}),t.jsx(d,{item:!0,md:12,children:t.jsx(E,{fullWidth:!0,options:e,value:p,onChange:g})}),t.jsx(d,{item:!0,md:12,children:t.jsx(h,{color:i.palette.text.secondary,children:"Content"})}),t.jsx(d,{item:!0,md:12,children:t.jsx(z,{value:a,onChange:f=>l(f||"")})})]}),childRight:t.jsx(h,{id:"preview",maxWidth:"100%",height:"100%",overflow:"auto",variant:"body1",component:"main",display:"block"})})})},re=async({request:e})=>{const i=new URL(e.url).searchParams.get("projectId");if(!i)throw w({},{status:400,statusText:"Bad request."});const n=Number.parseInt(i);if(!Number.isInteger(n))throw w({},{status:400,statusText:"Invalid project id."});if(!await D(n))throw w({},{status:400,statusText:"Non-existent project."});return document.title="New ticket",{tagOptions:await S(),projectId:n}},oe=async({params:e})=>{if(!e.ticketId)throw w({},{status:400,statusText:"Bad request."});const r=Number.parseInt(e.ticketId);if(!Number.isFinite(r))throw w({},{status:404,statusText:"Invalid ticket identifier."});const i=await at(r);if(!i)throw w({},{status:404,statusText:"Ticket not found."});document.title=i.title;const n=await S();return{ticket:i,tagOptions:n}},ne=e=>{const{isEditMode:r,slotEditor:i,slotPreview:n}=e,o=c.useRef(null),[s,a]=c.useState("");return c.useEffect(()=>{if(!o||!o.current)return;const l=o.current.offsetTop;a(`calc(98vh - ${Math.floor(l)}px)`)},[o]),t.jsx(F,{ref:o,paddingTop:2,marginLeft:2,children:t.jsxs(d,{container:!0,spacing:2,children:[r&&t.jsx(d,{item:!0,md:6,height:s,children:i}),t.jsx(d,{item:!0,md:!0,height:s,overflow:"auto",children:n})]})})},ie=()=>{const{ticket:e,tagOptions:r}=I(),i=N(),n=T(),[o,s]=c.useState(!1),[a,l]=c.useState(e),[p,g]=c.useState(a.title),[u,f]=c.useState(a.content),[x,P]=c.useState(a.tags);ot("ctrl+alt+e",()=>s(!o)),c.useEffect(()=>{(async()=>{if(!a||!o)return;const m=await st(a.projectId,p,u,x),j=await at(m);j&&l(j)})()},[u,x,p,o]),c.useEffect(()=>{const m=document.getElementById("preview");m&&(m.innerHTML=B(u))},[u]);const R=()=>{n({},{action:`/project/${a.projectId}`,method:"get"})};if(a)return t.jsxs(y,{location:a.title,seconadaryNav:t.jsx(k,{disableElevation:!0,variant:"contained",onClick:R,children:"Project home"}),children:[t.jsx(M,{size:"large",title:o?"Read":"Edit",sx:{position:"absolute",right:i.spacing(4),bottom:i.spacing(4)},onClick:()=>{s(!o)},children:o?t.jsx(et,{}):t.jsx(rt,{})}),t.jsx(ne,{isEditMode:o,slotEditor:t.jsxs(d,{container:!0,spacing:1,height:"100%",children:[t.jsx(d,{item:!0,md:12,children:t.jsx(C,{fullWidth:!0,required:!0,size:"small",label:"Project name",color:p.trim().length===0?"error":"primary",value:p,onChange:m=>g(m.target.value.normalize())})}),t.jsx(d,{item:!0,md:12,children:t.jsx(E,{fullWidth:!0,options:r,value:x,onChange:P})}),t.jsx(d,{item:!0,md:12,children:t.jsx(z,{value:u,onChange:m=>f(m||"")})})]}),slotPreview:t.jsxs(W,{maxWidth:"md",children:[!o&&t.jsxs(c.Fragment,{children:[t.jsxs(h,{variant:"subtitle2",children:["Created:"," ",a.dateCreated.toUTCString()]}),t.jsxs(h,{variant:"subtitle2",children:["Last modified:"," ",a.lastModified.toUTCString()]}),t.jsxs(h,{variant:"subtitle2",children:["Tags:"," ",a.tags.length>0?a.tags.join(", "):"-"]})]}),t.jsx(h,{id:"preview",maxWidth:"100%",height:"100%",overflow:"auto",component:"main",display:"block",sx:{wordBreak:"break-word",wordWrap:"break-word",scrollbarWidth:"thin"}})]})})]})},se=e=>{const{tickets:r}=e;return r.length===0?t.jsx(h,{variant:"body1",fontStyle:"italic",children:"No project to display."}):t.jsx(X,{children:r.map(({title:i,tags:n,projectId:o},s)=>t.jsxs(Y,{children:[t.jsx(H,{children:t.jsx(h,{width:"100%",display:"flex",alignItems:"center",justifyContent:"cetner",color:"secondary",fontSize:"large",fontWeight:"bolder",children:o})}),t.jsx($,{title:i,primaryTypographyProps:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"50%"},secondary:n.join(", "),children:i}),t.jsx(J,{children:t.jsx(M,{title:"Open",component:O,to:`/ticket/${o}`,color:"primary",children:t.jsx(Q,{})})})]},`project-${s}`))})},ft=[{value:"lastModified",label:"Last modified (0-9)",compareFn:(e,r)=>r.lastModified.getTime()-e.lastModified.getTime()},{value:"title",label:"Title (A-Z)",compareFn:(e,r)=>e.title.localeCompare(r.title)}],ae=async({request:e})=>{document.title="Tickets";let r=await ct();const i=new URL(e.url),n=i.searchParams.get("projectId"),o=i.searchParams.get("tags"),s=i.searchParams.get("sortRule"),a=await q(),l=await S(),p=it(o);if(nt(s,ft,r),!n)return{projectOptions:a,tagFilters:p,tagOptions:l,sortRule:s,project:null,tickets:r};const g=Number.parseInt(n);if(!Number.isInteger(g))throw w({},{status:400,statusText:"Invalid project id."});const u=await D(g);if(!u)throw w({},{status:400,statusText:"Non-existent project."});return r=r.filter(f=>f.projectId===g),r=r.filter(f=>p.every(x=>f.tags.includes(x))),{projectOptions:a,tagOptions:l,tagFilters:p,sortRule:s,project:u,tickets:r}},ce=()=>{const{project:e,sortRule:r,tagFilters:i,tickets:n,projectOptions:o,tagOptions:s}=I(),a=T(),[l,p]=c.useState(e),[g,u]=c.useState(i),f=()=>{!e||e.projectId===void 0||a({projectId:e.projectId},{action:"/ticket/create",method:"get"})},x=()=>{!e||e.projectId===void 0||a({},{action:`/project/${e.projectId}`,method:"get"})},P=m=>{let j="";l!==null&&l.projectId!==void 0&&(j=l.projectId.toString()),a({projectId:j,sortRule:m,tags:g},{action:"/ticket",method:"get"})},R=()=>{let m="";l!==null&&l.projectId!==void 0&&(m=l.projectId.toString()),a({projectId:m,sortRule:r||"",tags:g},{action:"/ticket",method:"get"})};return t.jsx(y,{location:"Tickets",seconadaryNav:t.jsxs(Ct,{disabled:e===null,disableElevation:!0,variant:"contained",children:[t.jsx(k,{onClick:x,children:"Project home"}),t.jsx(k,{startIcon:t.jsx(A,{}),onClick:f,children:"New ticket"})]}),children:t.jsxs(L,{spacing:2,padding:2,children:[t.jsxs(L,{spacing:1,direction:"row",children:[t.jsx(_,{size:"small",options:o,value:l,onChange:(m,j)=>p(j),getOptionLabel:({projectId:m,name:j})=>`${m}- ${j}`,renderInput:m=>t.jsx(C,{...m,label:"Project",size:"small"}),sx:{width:"40%"}}),t.jsx(E,{options:s,value:g,onChange:u,width:"30%"}),t.jsx(k,{disableElevation:!0,variant:"outlined",onClick:R,startIcon:t.jsx(V,{}),children:"filter"}),t.jsx(lt,{buttonProps:{disableElevation:!0,variant:"outlined",startIcon:t.jsx(tt,{})},children:t.jsx(ut,{sortRules:ft,rule:r,onChange:P})})]}),t.jsx(se,{tickets:n})]})})},de=xt([{index:!0,element:t.jsx(Zt,{}),loader:qt,errorElement:t.jsx(K,{})},{path:"/project",children:[{path:"/project/create",element:t.jsx(Xt,{}),loader:Yt},{path:"/project/:projectId",element:t.jsx(Vt,{}),loader:Jt}]},{path:"/ticket",errorElement:t.jsx(K,{}),children:[{index:!0,element:t.jsx(ce,{}),loader:ae},{path:"/ticket/create",element:t.jsx(ee,{}),loader:re},{path:"/ticket/:ticketId",element:t.jsx(ie,{}),loader:oe}]}],{basename:"/"}),le=()=>t.jsxs(St,{theme:pt,children:[t.jsx(Et,{}),t.jsx(wt,{router:de})]});jt.createRoot(document.getElementById("root")).render(t.jsx(gt.StrictMode,{children:t.jsx(le,{})}));
//# sourceMappingURL=index-ovd4Imcg.js.map
